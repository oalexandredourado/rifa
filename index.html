<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Rifa Filosofia</title>

<style>
body { font-family: Arial; background:#f4f4f4; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,180px); gap:16px; padding:20px; }

.card { background:#fff; padding:10px; border-radius:8px; cursor:pointer; position:relative; }
.card img { width:100%; height:200px; object-fit:cover; }
.card.escolhido { opacity:.4; pointer-events:none; }

.modal {
  display:none; position:fixed; inset:0; background:rgba(0,0,0,.6);
  align-items:center; justify-content:center;
}
.modal-content {
  background:white; padding:20px; border-radius:8px; width:300px;
}
</style>
</head>

<body>

<h2 style="text-align:center;">Escolha seu filósofo</h2>
<div class="grid" id="galeria"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="titulo"></h3>
    <input id="nome" placeholder="Seu nome"><br><br>
    <input id="tel" placeholder="Telefone"><br><br>
    <button onclick="confirmar()">Confirmar</button>
  </div>
</div>

<script>
let selecionado = null;

fetch("URL_WEB_APP_AQUI")
.then(r=>r.json())
.then(dados=>{
  const g = document.getElementById("galeria");
  dados.forEach(f=>{
    const c = document.createElement("div");
    c.className = "card " + (f.status==="escolhido"?"escolhido":"");
    c.innerHTML = `<img src="${f.imagem}"><b>${f.numero}</b><br>${f.nome}`;
    if(f.status==="disponivel"){
      c.onclick = ()=>abrir(f);
    }
    g.appendChild(c);
  });
});

function abrir(f){
  selecionado = f;
  document.getElementById("titulo").innerText =
    `Número ${f.numero} – ${f.nome}`;
  document.getElementById("modal").style.display="flex";
}

function confirmar(){
  const nome = document.getElementById("nome").value;
  const tel = document.getElementById("tel").value;

  if(!confirm(`Confirma a aquisição do número ${selecionado.numero} – ${selecionado.nome}?`))
    return;

  fetch("https://script.google.com/macros/s/AKfycbz99Q5wAIyfBQ8MF0GoNopGi_5s4ObjFTKho7XwpbiUibR40TAnbYUxitROkizvSHWVXw/exec",{
    method:"POST",
    body:JSON.stringify({
      numero: selecionado.numero,
      filosofo: selecionado.nome,
      nome,
      telefone: tel
    })
  })
  .then(r=>r.text())
  .then(res=>{
    alert(res==="OK" ? "Confirmado com sucesso!" : "Número indisponível");
    location.reload();
  });
}
</script>

</body>
</html>
