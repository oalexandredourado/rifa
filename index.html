<!DOCTYPE html>
<html lang="pt-br">
<meta charset="UTF-8">
<title>Galeria Filosófica</title>

<style>
body { font-family: Arial; background:#eee; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,200px); gap:16px; padding:20px;}
.card { background:#fff; padding:10px; border-radius:8px; cursor:pointer;}
.card.indisponivel { opacity:.4 }
.card img { width:100%; height:200px; object-fit:cover }
.modal { position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center }
.box { background:#fff; padding:20px; width:360px; border-radius:10px }
</style>

<h1>Escolha seu filósofo</h1>
<div class="grid" id="galeria"></div>

<div class="modal" id="modal">
  <div class="box">
    <h3 id="titulo"></h3>
    <img id="img" width="100%">
    <p id="bio"></p>

    <button id="btnEscolher">Escolher</button>

    <div id="form" style="display:none">
      <input id="nome" placeholder="Nome completo"><br><br>
      <input id="tel" placeholder="Telefone"><br><br>
      <button onclick="enviar()">Confirmar</button>
    </div>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxH-zQTIJbgY7ceDgcQgJLrCh-WUEo0huB8BZxUrwjwdrRJcSme4iIUsSUxtRFpo3rEpg/exec";
let atual;

fetch(API)
  .then(r => r.json())
  .then(dados => {
    dados.forEach(f => {
      const c = document.createElement("div");
      c.className = "card " + (f.status !== "disponivel" ? "indisponivel" : "");
      c.innerHTML = `<img src="${f.imagem}"><b>${f.numero}</b><br>${f.nome}`;
      c.onclick = () => abrir(f);
      galeria.appendChild(c);
    });
  });

function abrir(f) {
  atual = f;
  titulo.innerText = `Nº ${f.numero} – ${f.nome}`;
  img.src = f.imagem;
  bio.innerText = f.texto;

  btnEscolher.style.display = f.status === "disponivel" ? "block" : "none";
  form.style.display = "none";

  modal.style.display = "flex";

  btnEscolher.onclick = () => form.style.display = "block";
}

function enviar() {
  if (!confirm(`Confirma a aquisição do número ${atual.numero} - ${atual.nome}?`)) return;

  fetch(API, {
    method:"POST",
    body: JSON.stringify({
      nome: nome.value,
      telefone: tel.value,
      numero: atual.numero
    })
  }).then(() => {
    alert("Confirmado!");
    location.reload();
  });
}

modal.onclick = e => e.target === modal && (modal.style.display="none");
</script>
</html>
